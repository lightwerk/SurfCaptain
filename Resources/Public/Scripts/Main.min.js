"use strict";angular.module("surfCaptain",["ngRoute","xeditable","ngAnimate","ngMessages","ngBiscuit"]).config(["$routeProvider",function(a){var b="/_Resources/Static/Packages/Lightwerk.SurfCaptain/Scripts/SurfCaptainApp/Templates/";a.when("/",{templateUrl:b+"Projects.html",controller:"ProjectsController"}).when("/project/:projectName",{templateUrl:b+"Project.html",controller:"ProjectController"}).when("/project/:projectName/deploy",{templateUrl:b+"Deploy.html",controller:"DeployController"}).when("/project/:projectName/sync",{templateUrl:b+"Sync.html",controller:"SyncController"}).when("/project/:projectName/server",{templateUrl:b+"Server.html",controller:"ServerController"}).when("/about",{templateUrl:b+"About.html",controller:"AboutController"}).when("/globalserver",{templateUrl:b+"GlobalServer.html",controller:"GlobalServerController"}).when("/extensions",{templateUrl:b+"Extensions.html",controller:"ExtensionsController"}).when("/deployments",{templateUrl:b+"Deployments.html",controller:"DeploymentsController"}).when("/project/:projectName/deployment/:deploymentId",{templateUrl:b+"SingleDeployment.html",controller:"SingleDeploymentController"}).otherwise({redirectTo:"/"})}]).value("version","1.0.0").constant("SEVERITY",{ok:0,info:1,warning:2,error:3}).constant("CONFIG",{applicationTypes:{deploy:"Deploy",deployTYPO3:"TYPO3\\CMS\\Deploy",syncTYPO3:"TYPO3\\CMS\\Shared"}}),angular.module("surfCaptain").run(["editableOptions",function(a){a.theme="bs3"}]),function(){function a(a){a.techs=[{name:"angular",url:"https://angularjs.org/",description:{headline:"AngularJS",span1:"JavaScript",span2:"Framework"}},{name:"flow",url:"http://flow.typo3.org/",description:{headline:"TYPO3 FLOW",span1:"PHP-Application",span2:"Framework"}},{name:"bootstrap",url:"http://getbootstrap.com/",description:{headline:"Bootstrap",span1:"CSS",span2:"Framework"}}],a.subtechs=[{name:"grunt",url:"http://gruntjs.com/",description:{headline:"Grunt"}},{name:"bower",url:"http://bower.io/",description:{headline:"Bower"}},{name:"composer",url:"https://getcomposer.org/",description:{headline:"Composer"}},{name:"karma",url:"http://karma-runner.github.io",description:{headline:"Karma"}},{name:"jasmine",url:"http://jasmine.github.io/",description:{headline:"Jasmine"}},{name:"jquery",url:"http://jquery.com/",description:{headline:"jQuery"}},{name:"css3",url:"http://en.wikipedia.org/wiki/Cascading_Style_Sheets#CSS_3",description:{headline:"CSS 3"}},{name:"git",url:"http://git-scm.com/",description:{headline:"git"}},{name:"html5",url:"http://en.wikipedia.org/wiki/HTML5",description:{headline:"HTML 5"}},{name:"mysql",url:"http://www.mysql.com/",description:{headline:"MySQL"}},{name:"less",url:"http://www.lesscss.de/",description:{headline:"LESS"}}]}angular.module("surfCaptain").controller("AboutController",a),a.$inject=["$scope"]}(),function(){function a(a,b){a.getRootContext=function(c){return b.getRootContext(c,a.contexts)}}angular.module("surfCaptain").controller("AbstractApplicationController",a),a.$inject=["$scope","PresetService"]}(),function(){function a(a,b,c,d,e,f){a.name=b.projectName,a.project={},a.messages={},a.error=!1,this.init=function(){c.getProjects().then(function(b){a.project=c.getProjectByName(a.name,b),d.addFavoriteProject(a.project)},function(){a.finished=!0,a.messages=e.addFlashMessage("Error!","API call failed. Please try again later.",f.error,"request-error"),a.error=!0})},this.init()}angular.module("surfCaptain").controller("AbstractSingleProjectController",a),a.$inject=["$scope","$routeParams","ProjectRepository","FavorService","FlashMessageService","SEVERITY"]}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k){function l(a){this.name="DeployControllerException",this.message=a}angular.extend(this,b("AbstractSingleProjectController",{$scope:a})),angular.extend(this,b("AbstractApplicationController",{$scope:a}));var m="loading ...",n=this;l.prototype=new Error,l.prototype.constructor=l,a.deployableCommits=[{name:m,group:"Tags"},{name:m,group:"Branches"}],a.servers=[],a.error=!1,a.finished=!1,a.currentPreset={},a.tags=[],this.addFailureFlashMessage=function(b,c){a.finished=!0,a.messages=e.addFlashMessage("Error!",b,d.error,c?"deployment-project-call-failed":void 0),a.error=!0},this.getCurrentCommit=function(){var b=a.deployableCommits.filter(function(b){return b.identifier===a.selectedCommit});if(angular.isUndefined(b[0])||null===b||b.length>1)throw new l("Something went wrong with the chosen Commit");return b[0]},a.setCurrentPreset=function(b){a.currentPreset=b,angular.isDefined(a.selectedCommit)&&""!==a.selectedCommit&&a.setCommitInCurrentPreset()},a.deploy=function(b){b===a.currentPreset&&(angular.isUndefined(a.currentPreset.applications[0].type)&&(a.currentPreset.applications[0].type=f.applicationTypes.deployTYPO3),angular.isDefined(a.currentPreset.applications[0].options.deploymentPathWithMarkers)&&delete a.currentPreset.applications[0].options.deploymentPathWithMarkers,(angular.isUndefined(a.currentPreset.applications[0].options.repositoryUrl)||""===a.currentPreset.applications[0].options.repositoryUrl)&&(a.currentPreset.applications[0].options.repositoryUrl=a.project.repositoryUrl),g.addDeployment(a.currentPreset).then(function(b){a.messages=e.addFlashMessage("OK!",a.currentCommit.type+" "+a.currentCommit.name+" will be shortly deployed onto "+a.currentPreset.applications[0].nodes[0].name+"! You can cancel the deployment while it is still waiting.",d.ok),c.updateFullProjectInCache(a.project.repositoryUrl),h.path("project/"+a.name+"/deployment/"+b.deployment.__identity)},function(){n.addFailureFlashMessage("Deployment configuration could not be submitted successfully. Try again later.",!1)}))},a.setCommitInCurrentPreset=function(){try{switch(a.currentCommit=n.getCurrentCommit(),a.currentCommit.type){case"Branch":delete a.currentPreset.applications[0].options.tag,a.currentPreset.applications[0].options.branch=a.currentCommit.name;break;case"Tag":delete a.currentPreset.applications[0].options.branch,a.currentPreset.applications[0].options.tag=a.currentCommit.name;break;default:return n.addFailureFlashMessage("Something is wrong with the type of the chosen commit. This should never happen. In fact, If you see this message, please go ahaed and punch any of the involved developers in the face.",!1),void(a.currentCommit=null)}a.currentPreset.applications[0].options.sha1=a.currentCommit.commit.id}catch(b){n.addFailureFlashMessage(b.message,!1),a.currentCommit=null}},a.presetDisplay=function(b){return angular.isUndefined(a.currentPreset.applications)?"":a.currentPreset===b?"":"disabled"},a.unsetLoadingKeyForGroup=function(b){var c;for(c in a.deployableCommits)if(a.deployableCommits.hasOwnProperty(c)&&angular.isDefined(a.deployableCommits[c].name)&&angular.isDefined(a.deployableCommits[c].group)&&a.deployableCommits[c].name===m&&a.deployableCommits[c].group===b){a.deployableCommits.splice(c,1);break}},a.getDeployedTag=function(b){return k.getDeployedTag(b,a.tags)},a.$watch("project",function(b){angular.isUndefined(b.repositoryUrl)||(c.getFullProjectByRepositoryUrl(b.repositoryUrl).then(function(b){var c,g=b.repository.presets;a.repositoryUrl=b.repository.webUrl,b.repository.tags.sort(k.byCommitDate),b.repository.branches.sort(k.byCommitDate),a.tags=b.repository.tags,a.deployableCommits=b.repository.tags,jQuery.merge(a.deployableCommits,b.repository.branches);for(c in g)g.hasOwnProperty(c)&&(angular.isUndefined(g[c].applications[0].type)||g[c].applications[0].type===f.applicationTypes.deployTYPO3||g[c].applications[0].type===f.applicationTypes.deploy)&&a.servers.push(g[c]);a.finished=!0,0===a.servers.length&&(a.messages=e.addFlashMessage("No Servers yet!",'FYI: There are no servers for project <span class="uppercase">'+a.name+"</span> yet. Why dont you create one, hmm?",d.info,a.name+"-no-servers"))},function(){n.addFailureFlashMessage("API call failed. Deployment not possible.",!0)}),i.getGlobalServers("").then(function(b){a.globalServers=b.presets},function(){n.addFailureFlashMessage("API call failed. Deployment not possible.",!0)}),j.getSettings().then(function(b){a.contexts=[],angular.isDefined(b.contexts)&&(a.contexts=b.contexts.split(","))}))})}angular.module("surfCaptain").controller("DeployController",a),a.$inject=["$scope","$controller","ProjectRepository","SEVERITY","FlashMessageService","CONFIG","DeploymentRepository","$location","PresetRepository","SettingsRepository","UtilityService"]}(),function(){function a(a,b,c,d){var e=this;this.setDeployments=function(b){a.deployments=b},this.init=function(){b.getAllDeployments().then(function(b){a.finished=!0,e.setDeployments(b.deployments)},function(){a.finished=!0,c.addFlashMessage("Error!","The API call failed. Please try again later.",d.error,"deployment-list-no-response")})},this.init(),a.deployments=[],a.finished=!1}angular.module("surfCaptain").controller("DeploymentsController",a),a.$inject=["$scope","DeploymentRepository","FlashMessageService","SEVERITY"]}(),function(){function a(){}angular.module("surfCaptain").controller("ExtensionsController",a)}(),function(){function a(a,b,c,d,e,f){var g=this;a.newPreset=c.getNewPreset(),a.finished=!1,a.messages=[],a.serverNames=[],this.setServerNames=function(){var b;for(b in a.servers)a.servers.hasOwnProperty(b)&&a.serverNames.push(b)},this.getSettings=function(){f.getSettings().then(function(b){a.contexts="",angular.isDefined(b.contexts)&&(a.contexts=b.contexts.split(","))})},a.getAllServers=function(){b.getGlobalServers("").then(function(b){a.finished=!0,a.servers=b.presets,g.setServerNames(),0===a.servers.length&&(a.messages=d.addFlashMessage("FYI!","There are no servers yet. Why dont you create one, hmm?",e.info,"global-server-request-no-results"))},function(){a.finished=!0,a.messages=d.addFlashMessage("Request failed!","The global servers could not be received. Please try again later..",e.error,"global-server-request-failed")})},a.addServer=function(f){a.finished=!1,b.addServer(f).then(function(){a.newPreset=c.getNewPreset(),a.newServerForm.$setPristine(),a.getAllServers(),a.messages=d.addFlashMessage("Server created!","The Server "+f.nodes[0].name+" was successfully created.",e.ok)},function(){a.finished=!0,a.messages=d.addFlashMessage("Creation failed!",'The Server "'+f.nodes[0].name+'" could not be created.',e.error)})},this.init=function(){g.getSettings(),a.getAllServers()},this.init()}angular.module("surfCaptain").controller("GlobalServerController",a),a.$inject=["$scope","PresetRepository","PresetService","FlashMessageService","SEVERITY","SettingsRepository"]}(),function(){function a(a,b,c,d,e,f,g,h){angular.extend(this,b("AbstractSingleProjectController",{$scope:a})),a.ordering="date",a.finished=!1,a.tags=[],a.getRootContext=function(b){return f.getRootContext(b,a.contexts)},a.getDeployedTag=function(b){return h.getDeployedTag(b,a.tags)},a.$watch("project",function(b){angular.isUndefined(b.repositoryUrl)||g.getSettings().then(function(c){a.contexts=[],angular.isDefined(c.contexts)&&(a.contexts=c.contexts.split(",")),d.getFullProjectByRepositoryUrl(b.repositoryUrl).then(function(b){a.finished=!0,a.deployments=b.repository.deployments,a.presets=b.repository.presets,a.tags=b.repository.tags},function(){a.finished=!0})})})}angular.module("surfCaptain").controller("ProjectController",a),a.$inject=["$scope","$controller","FlashMessageService","ProjectRepository","SEVERITY","PresetService","SettingsRepository","UtilityService"]}(),function(){function a(a,b,c,d,e){a.settings={},a.ordering="name",a.projects=[],a.finished=!1,this.init=function(){b.getProjects().then(function(b){a.finished=!0,a.projects=b},function(){a.finished=!0,a.messages=e.addFlashMessage("Error!","API call failed. GitLab is currently not available.",d.error,"projects-loaded-error")}),c.getSettings().then(function(b){a.settings=b})},this.init()}angular.module("surfCaptain").controller("ProjectsController",a),a.$inject=["$scope","ProjectRepository","SettingsRepository","SEVERITY","FlashMessageService"]}(),function(){function a(a,b,c,d,e,f,g,h,i,j){function k(a){this.name="ServerControllerException",this.message=a}var l=this;angular.extend(this,b("AbstractSingleProjectController",{$scope:a})),k.prototype=new Error,k.prototype.constructor=k,a.finished=!1,a.currentPreset={},a.messages=[],a.serverNames=[],this.setServerNames=function(){var b;a.serverNames=[];for(b in a.servers)a.servers.hasOwnProperty(b)&&a.serverNames.push(b)},this.setTakenServerNamesAsUnavailableSuggestions=function(){var b,c,e=0;if(a.serverNames.length)for(b=a.nameSuggestions.length,e;b>e;e++)c=a.generateServerName(a.nameSuggestions[e].suffix),a.nameSuggestions[e].available=!d.doesArrayContainItem(a.serverNames,c)},this.generateNameSuggestions=function(b){var c,d;a.nameSuggestions=[];for(c in b)b.hasOwnProperty(c)&&(d={suffix:c,available:!0,context:b[c]},a.nameSuggestions.push(d))},this.handleSettings=function(){var b;angular.isUndefined(a.settings)||(a.contexts="",angular.isDefined(a.settings.contexts)&&(a.contexts=a.settings.contexts.split(",")),angular.isDefined(a.settings.nameSuggestions)&&l.generateNameSuggestions(a.settings.nameSuggestions),angular.isDefined(a.settings.defaultDeploymentPath)&&(b=a.settings.defaultDeploymentPath,d.doesStringContainSubstring(b,"{{")&&(b=f.replaceMarkers(b,a.project)),d.doesStringContainSubstring(b,"{{")?(a.newPreset.options.deploymentPath=f.getStringBeforeFirstMarker(b),a.newPreset.options.deploymentPathWithMarkers=b):a.newPreset.options.deploymentPath=b))},this.successCallback=function(b){a.finished=!0,a.servers=b.repository.presets,l.setServerNames(),angular.isDefined(a.nameSuggestions)&&l.setTakenServerNamesAsUnavailableSuggestions(),0===a.servers.length&&(a.messages=h.addFlashMessage("No Servers yet!",'FYI: There are no servers for project <span class="uppercase">'+a.name+"</span> yet. Why dont you create one, hmm?",i.info,a.name+"-no-servers"))},this.failureCallback=function(){a.finished=!0,a.messages=h.addFlashMessage("Request failed!","The servers could not be received. Please try again later..",i.error,"server-request-failed")},a.getAllServers=function(b){a.newPreset.options.repositoryUrl=a.project.repositoryUrl,b===!1?j.getFullProjectByRepositoryUrlFromServer(a.project.repositoryUrl).then(l.successCallback,l.failureCallback):j.getFullProjectByRepositoryUrl(a.project.repositoryUrl).then(l.successCallback,l.failureCallback)},a.setDeploymentPath=function(b){var c;angular.isDefined(a.newPreset.options.deploymentPathWithMarkers)&&(c=f.replaceMarkers(a.newPreset.options.deploymentPathWithMarkers,{suffix:b}),a.newPreset.options.deploymentPath=c)},a.addServer=function(b){a.finished=!1,angular.isDefined(b.options.deploymentPathWithMarkers)&&delete b.options.deploymentPathWithMarkers,c.addServer(b).then(function(){a.newPreset=g.getNewPreset(a.settings),a.newServerForm.$setPristine(),l.handleSettings(),a.getAllServers(!1),a.messages=h.addFlashMessage("Server created!",'The Server "'+b.nodes[0].name+'" was successfully created.',i.ok)},function(){a.finished=!0,a.messages=h.addFlashMessage("Creation failed!",'The Server "'+b.nodes[0].name+'" could not be created.',i.error)})},a.generateServerName=function(b){if(angular.isUndefined(a.project))throw new k("No project given.");if(angular.isUndefined(a.project.identifier))throw new k("Project got no identifier.");return a.project.identifier+"-"+b},a.$watch("project",function(b){angular.isDefined(b.name)&&e.getSettings().then(function(b){a.settings=b,a.newPreset=g.getNewPreset(a.settings),l.handleSettings(),a.getAllServers()},function(){a.newPreset=g.getNewPreset(),a.getAllServers()})})}angular.module("surfCaptain").controller("ServerController",a),a.$inject=["$scope","$controller","PresetRepository","ValidationService","SettingsRepository","MarkerService","PresetService","FlashMessageService","SEVERITY","ProjectRepository"]}(),function(){function a(a,b,c,d,e,f,g,h,i){var j=this;angular.extend(this,i("AbstractSingleProjectController",{$scope:a})),this.initLiveLog=function(){if(!a.noLog)switch(a.deployment.status){case"success":case"failed":case"cancelled":return angular.isUndefined(d.get("deploymentCache"))&&d("deploymentCache"),d.get("deploymentCache").put(a.deployment.__identity,a.deployment),void h.updateFullProjectInCache(a.deployment.repositoryUrl);case"waiting":case"running":setTimeout(j.getDeployment,1e3);break;default:return}},this.getDeployment=function(){b.getSingleDeployment(c.deploymentId).then(function(b){a.finished=!0,a.deployment=b.deployment,j.initLiveLog()},function(){a.finished=!0,a.noLog=!0})},this.init=function(){this.getDeployment()},this.init(),a.cancelDeployment=function(){b.cancelDeployment(c.deploymentId).then(function(){j.getDeployment()})},a.deployConfigurationAgain=function(){b.addDeployment(a.deployment.configuration).then(function(b){a.messages=f.addFlashMessage("OK!",a.deployment.referenceName+" will be shortly deployed onto "+a.deployment.configuration.applications[0].nodes[0].name+"! You can cancel the deployment while it is still waiting.",g.ok),e.path("project/"+a.name+"/deployment/"+b.deployment.__identity)},function(){a.messages=f.addFlashMessage("Error!","Deployment configuration could not be submitted successfully. Try again later.",g.error)})},a.finished=!1,a.noLog=!1}angular.module("surfCaptain").controller("SingleDeploymentController",a),a.$inject=["$scope","DeploymentRepository","$routeParams","$cacheFactory","$location","FlashMessageService","SEVERITY","ProjectRepository","$controller"]}(),function(){function a(a,b,c,d,e,f,g,h,i,j){angular.extend(this,b("AbstractSingleProjectController",{$scope:a})),angular.extend(this,b("AbstractApplicationController",{$scope:a}));var k=this;a.servers=[],a.finished=!1,a.currentSource={},a.currentTarget={},this.addFailureFlashMessage=function(){a.finished=!0,a.messages=e.addFlashMessage("Request failed!","API call failed. Sync not possible.",f.error,a.name+"-sync-call-failed")},this.setContexts=function(){h.getSettings().then(function(b){a.contexts=[],angular.isDefined(b.contexts)&&(a.contexts=b.contexts.split(","))})},this.setGlobalServers=function(){c.getGlobalServers("").then(function(b){a.globalServers=b.presets},function(){k.addFailureFlashMessage()})},this.init=function(){k.setContexts(),k.setGlobalServers()},this.init(),a.sourceDisplay=function(b){return angular.isUndefined(a.currentSource.applications)?"":a.currentSource===b?"":"disabled"},a.targetDisplay=function(b){return angular.isUndefined(a.currentTarget.applications)?"":a.currentTarget===b?"":"disabled"},a.setCurrentSource=function(b){a.currentSource=b},a.setCurrentTarget=function(b){a.currentTarget=b},a.sync=function(b,c){c.applications[0].type=d.applicationTypes.syncTYPO3,c.applications[0].options.sourceNode=b.applications[0].nodes[0],c.applications[0].options.sourceNode.deploymentPath=b.applications[0].options.deploymentPath,c.applications[0].options.repositoryUrl=a.project.repositoryUrl,i.addDeployment(c).then(function(d){a.messages=e.addFlashMessage("OK!",c.applications[0].nodes[0].name+" will be synchronized with "+b.applications[0].nodes[0].name+".",f.ok),g.updateFullProjectInCache(a.project.repositoryUrl),j.path("project/"+a.name+"/deployment/"+d.deployment.__identity)},k.addFailureFlashMessage)},a.$watch("project",function(b){angular.isUndefined(b.repositoryUrl)||g.getFullProjectByRepositoryUrl(b.repositoryUrl).then(function(b){var c,g=b.repository.presets;for(c in g)g.hasOwnProperty(c)&&(angular.isUndefined(g[c].applications[0].type)||g[c].applications[0].type===d.applicationTypes.syncTYPO3)&&a.servers.push(g[c]);a.finished=!0,0===a.servers.length&&(a.messages=e.addFlashMessage("No Servers yet!",'FYI: There are no servers for project <span class="uppercase">'+a.name+"</span> yet. Why dont you create one, hmm?",f.info,a.name+"-no-servers"))},function(){k.addFailureFlashMessage()})})}angular.module("surfCaptain").controller("SyncController",a),a.$inject=["$scope","$controller","PresetRepository","CONFIG","FlashMessageService","SEVERITY","ProjectRepository","SettingsRepository","DeploymentRepository","$location"]}(),function(){function a(a){var b=function(b,c){b.$watchCollection("chosen",function(b,d){angular.isArray(b)&&b!==d&&a(function(){c.trigger("liszt:updated"),c.trigger("chosen:updated")},1e3)}),c.chosen({search_contains:!0})};return{restrict:"A",link:b,scope:{chosen:"="}}}angular.module("surfCaptain").directive("chosen",a),a.$inject=["$timeout"]}(),angular.module("surfCaptain").directive("flashMessages",["SEVERITY","FlashMessageService",function(a,b){var c=function(c,d,e){var f=function(b){switch(b){case a.ok:return"ok";case a.info:return"info";case a.warning:return"warning";case a.error:return"error";default:return"info"}},g=function(a){return a instanceof Date?"Time: "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds():""},h=function(a,b){var c=b?' id="'+b+'">':'">';return'<div class="flash-message"'+c+'<div class="flash-message-title '+f(a.severity)+'">'+a.title+'<span class="close" onclick="angular.element(this).parent().parent().remove()">&times;</span></div><div class="flash-message-message">'+a.message+'</div><div class="flash-message-footer"><span class="time">'+g(a.time)+"</span></div>"};c.$watchCollection(e.messages,function(a){var c,d,e,f=0,g="";if(angular.isDefined(a)&&(c=a.length)){for(f;c>f;f++)d=a[f],e="",angular.isDefined(d.id)?(e=d.id,g+=angular.element("#"+e).length?"":h(d,e)):g+=h(d,e);angular.element(".flash-messages-container").append(g),b.flush()}})};return{restrict:"E",scope:{messages:"="},link:c}}]),angular.module("surfCaptain").directive("lastCharacterValidate",["ValidationService",function(a){return{restrict:"A",require:"ngModel",scope:{character:"@character"},link:function(b,c,d,e){var f=b.character||"";e.$parsers.unshift(function(b){var c=b?a.doesLastCharacterMatch(b.slice(-1),f):!1;return e.$setValidity("last-character-validate",c),c?b:void 0}),e.$formatters.unshift(function(b){var c=b?a.doesLastCharacterMatch(b.slice(-1),f):!1;return e.$setValidity("last-character-validate",c),b})}}}]),angular.module("surfCaptain").directive("modal",function(){return{scope:{modal:"@modal"},link:function(a,b){b.bind("click",function(){angular.element("."+a.modal).modal()})}}}),angular.module("surfCaptain").directive("overlay",function(){var a=function(){};return{restrict:"E",template:"<div data-ng-class=\"{false:'overlay'}[finished]\"></div>",scope:{finished:"="},link:a}}),function(){function a(a,b,c,d,e,f){var g=function(g){g.toggleSpinnerAndOverlay=function(){g.finished=!g.finished,g.$parent.finished=!g.$parent.finished},e.getSettings().then(function(a){g.contexts="",angular.isDefined(a.contexts)&&(g.contexts=a.contexts.split(","))}),g.getRootContext=function(a){var c=0,d=g.contexts.length;for(c;d>c;c++)if(b.doesStringStartWithSubstring(a,g.contexts[c]))return g.contexts[c];return""},g.setCurrentPreset=function(a){g.currentPreset=a},g.deleteServer=function(b){g.toggleSpinnerAndOverlay(),a.deleteServer(b).then(function(){g.$parent.getAllServers(!1),g.messages=c.addFlashMessage("Server deleted!",'The Server "'+b.applications[0].nodes[0].name+'" was successfully removed.',d.ok)},function(){g.toggleSpinnerAndOverlay(),g.messages=c.addFlashMessage("Deletion failed!",'The Server "'+b.applications[0].nodes[0].name+'" could not be removed.',d.error)})},g.updateServer=function(b){g.toggleSpinnerAndOverlay(),a.updateServer(b.applications[0]).then(function(){b.changed=!1,g.toggleSpinnerAndOverlay(),angular.isDefined(g.$parent.project)&&f.updateFullProjectInCache(g.$parent.project.repositoryUrl),g.messages=c.addFlashMessage("Update successful!",'The Server "'+b.applications[0].nodes[0].name+'" was updated successfully.',d.ok)},function(){g.toggleSpinnerAndOverlay(),g.messages=c.addFlashMessage("Update failed!",'The Server "'+b.applications[0].nodes[0].name+'" could not be updated.',d.error)})},g.updateHost=function(a){return b.hasLength(a,1,"Host must not be empty!")},g.updateDeploymentPath=function(a){var c=b.hasLength(a,1,"DeploymentPath is required!");return c===!0?b.doesLastCharacterMatch(a,"/",'DeploymentPath must end with "/"!'):c},g.updateUsername=function(a){return b.hasLength(a,1,"User must not be empty!")},g.updateContext=function(a){var c=0,d=g.contexts.length;for(c;d>c;c++)if(b.doesStringStartWithSubstring(a,g.contexts[c]))return!0;return"Context must start with either Development, Testing or Production!"}};return{restrict:"E",templateUrl:"/_Resources/Static/Packages/Lightwerk.SurfCaptain/Scripts/SurfCaptainApp/Partials/ServerList.html",scope:{servers:"=",getAllServers:"&",finished:"=",messages:"=",project:"="},link:g}}angular.module("surfCaptain").directive("serverList",a),a.$inject=["PresetRepository","ValidationService","FlashMessageService","SEVERITY","SettingsRepository","ProjectRepository"]}(),function(){function a(){return{restrict:"A",require:"ngModel",scope:{serverNames:"="},link:function(a,b,c,d){d.$parsers.unshift(function(b){var c=void 0===a.serverNames||-1===a.serverNames.indexOf(b);return d.$setValidity("server-name-validate",c),c?b:void 0}),d.$formatters.unshift(function(b){var c=void 0===a.serverNames||-1===a.serverNames.indexOf(b);return d.$setValidity("server-name-validate",c),b})}}}angular.module("surfCaptain").directive("serverNameValidate",a)}(),function(){function a(){function a(){}return{restrict:"E",template:'<i class="fa fa-spinner fa-spin fa-4x"></i>',link:a}}angular.module("surfCaptain").directive("spinner",a)}(),function(){function a(a){return{restrict:"A",require:"ngModel",scope:{startWithValidate:"="},link:function(b,c,d,e){e.$parsers.unshift(function(c){var d,f=0;if(angular.isUndefined(b.startWithValidate))return e.$setValidity("start-with-validate",!0),c;for(d=b.startWithValidate.length,f;d>f;f++)if(a.doesStringStartWithSubstring(c,b.startWithValidate[f]))return e.$setValidity("start-with-validate",!0),c;return void e.$setValidity("start-with-validate",!1)}),e.$formatters.unshift(function(c){var d,f=0;if(angular.isUndefined(b.startWithValidate))return e.$setValidity("start-with-validate",!0),c;for(d=b.startWithValidate.length,f;d>f;f++)if(a.doesStringStartWithSubstring(c,b.startWithValidate[f]))return e.$setValidity("start-with-validate",!0),c;return e.$setValidity("start-with-validate",!1),c})}}}angular.module("surfCaptain").directive("startWithValidate",a),a.$inject=["ValidationService"]}(),function(){function a(a,b,c){function d(d){var e=b.path().split("/").pop();d.project=a.itemName,d.context=e===d.project?"":e,d.favorites=c.getFavoriteProjects()}return{restrict:"E",templateUrl:"/_Resources/Static/Packages/Lightwerk.SurfCaptain/Scripts/SurfCaptainApp/Partials/Header.html",scope:{icon:"@icon"},link:d}}angular.module("surfCaptain").directive("surfcaptainHeader",a),a.$inject=["$routeParams","$location","FavorService"]}(),function(){function a(a,b){function c(c){var d=b.path().split("/").pop();c.project=a.projectName,c.context=d===c.project?"history":d}return{restrict:"E",templateUrl:"/_Resources/Static/Packages/Lightwerk.SurfCaptain/Scripts/SurfCaptainApp/Partials/Menu.html",scope:{},link:c}}angular.module("surfCaptain").directive("surfcaptainMenu",a),a.$inject=["$routeParams","$location"]}(),function(){function a(){return function(a,b){b.bind("click",function(a){a.preventDefault(),angular.element(this).tab("show")})}}angular.module("surfCaptain").directive("tab",a)}(),function(){function a(){return function(a,b){b.tooltip()}}angular.module("surfCaptain").directive("tooltip",a)}(),function(){function a(a){return function(b,c){c.text(a)}}angular.module("surfCaptain").directive("appVersion",a),a.$inject=["version"]}(),function(){function a(){return function(a){switch(a){case"TYPO3CMSDeploy":case"TYPO3\\CMS\\Deploy":return"Deployment";case"TYPO3CMSShared":case"TYPO3\\CMS\\Shared":return"Sync";default:return a}}}angular.module("surfCaptain").filter("DeploymentTypeFilter",a)}(),function(){function a(){return function(a){switch(a){case 3:case"3":return"error";case 4:case"4":return"warning";case 5:case"5":return"notice";case 6:case"6":return"info";case 7:case"7":return"debug";default:return a}}}angular.module("surfCaptain").filter("logCodeFilter",a)}(),function(){function a(a,b,c){var d={},e="/api/deployment";return c("deploymentCache"),d.addDeployment=function(c){var d={configuration:{}},f=b.defer();return d.configuration=c,a({method:"POST",url:e,data:{deployment:d},headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(f.resolve).error(f.reject),f.promise},d.getDeployments=function(){var c=b.defer();return a.get(e).success(c.resolve).error(c.reject),c.promise},d.getSingleDeployment=function(d){var f=b.defer();return angular.isDefined(c.get("deploymentCache").get(d))?(f.resolve({deployment:c.get("deploymentCache").get(d)}),f.promise):(a.get(e+"?deployment="+d).success(f.resolve).error(f.reject),f.promise)},d.cancelDeployment=function(c){var d=b.defer();return a({method:"PUT",url:e,data:{deployment:{__identity:c,status:"cancelled"}}}).success(d.resolve).error(d.reject),d.promise},{addDeployment:function(a){return d.addDeployment(a)},cancelDeployment:function(a){return d.cancelDeployment(a)},getAllDeployments:function(){return d.getDeployments()},getSingleDeployment:function(a){return d.getSingleDeployment(a)}}}angular.module("surfCaptain").factory("DeploymentRepository",a),a.$inject=["$http","$q","$cacheFactory"]}(),function(){function a(a,b){function c(a){this.name="PresetRepositoryException",this.message=a}var d={},e="/api/preset";return c.prototype=new Error,c.prototype.constructor=c,d.getFullPresetAsString=function(a){return angular.toJson(d.getFullPreset(a),!1)},d.getFullPreset=function(a){var b={applications:[]};return b.applications[0]=a,b},d.getKeyFromServerConfiguration=function(a){if(angular.isUndefined(a.nodes[0].name)){if(angular.isUndefined(a.applications[0].nodes[0].name))throw new c("PresetRepository.getKeyFromServerConfiguration failed. Server configuration contains no key.");return a.apllications[0].nodes[0].name}return a.nodes[0].name},d.getApplicationContainer=function(a){var b={applications:[]};return b.applications[0]=a,b},d.getGlobalServers=function(){var c=b.defer();return a.get(e+"?globals=1").success(c.resolve).error(c.reject),c.promise},d.putServer=function(a){return this.sendSinglePresetToApi(a,"put")},d.postServer=function(a){return this.sendSinglePresetToApi(a,"post")},d.sendSinglePresetToApi=function(c,f){var g=b.defer();return a({method:f,url:e,data:{key:this.getKeyFromServerConfiguration(c),configuration:d.getFullPreset(c)},headers:{Accept:"application/json"}}).success(g.resolve).error(g.reject),g.promise},d.deleteServer=function(c){var f=b.defer();return a.delete(e+"?key="+d.getKeyFromServerConfiguration(c.applications[0])).success(f.resolve).error(f.reject),f.promise},{getGlobalServers:function(){return d.getGlobalServers()},updateServer:function(a){return d.putServer(a)},addServer:function(a){return d.postServer(a)},deleteServer:function(a){return d.deleteServer(a)}}}angular.module("surfCaptain").factory("PresetRepository",a),a.$inject=["$http","$q"]}(),function(){function a(a,b,c){function d(a){this.name="ProjectRepositoryException",this.message=a}var e={},f="/api/repository",g=c("projectCache"),h=c("projectsCache"),i=c("repositoryCache");return d.prototype=new Error,d.prototype.constructor=d,e.populateSingleProjectCache=function(a){var b=angular.isDefined(a)?a.length:0,c=0;if(b)for(c;b>c;c++)g.put(a[c].identifier,a[c])},e.getProjects=function(){var c=b.defer();return angular.isDefined(h.get("allProjects"))?(c.resolve(h.get("allProjects")),c.promise):(a.get(f,{cache:!0,headers:{Accept:"application/json"}}).success(function(a){c.resolve(a.repositories),h.put("allProjects",a.repositories),e.populateSingleProjectCache(a.repositories)}).error(c.reject),c.promise)},e.getProjectByName=function(a,b){if(angular.isUndefined(g.get(a))&&e.populateSingleProjectCache(b),g=c.get("projectCache"),angular.isUndefined(g.get(a)))throw new d("Could not find project");return g.get(a)},e.getFullProjectByRepositoryUrl=function(c){var d=b.defer();return angular.isDefined(i.get(c))?(d.resolve(i.get(c)),e.updateFullProjectInCache(c)):a.get(f+"?repositoryUrl="+c).success(function(a){i.put(c,a),d.resolve(a)
}).error(d.reject),d.promise},e.getFullProjectByRepositoryUrlFromServer=function(c){var d=b.defer();return a.get(f+"?repositoryUrl="+c).success(function(a){i.put(c,a),d.resolve(a)}).error(d.reject),d.promise},e.updateFullProjectInCache=function(b){a.get(f+"?repositoryUrl="+b).success(function(a){i.put(b,a)})},{getProjects:function(){return e.getProjects()},getProjectByName:function(a,b){return e.getProjectByName(a,b)},getFullProjectByRepositoryUrl:function(a){return e.getFullProjectByRepositoryUrl(a)},updateFullProjectInCache:function(a){e.updateFullProjectInCache(a)},getFullProjectByRepositoryUrlFromServer:function(a){return e.getFullProjectByRepositoryUrlFromServer(a)}}}angular.module("surfCaptain").factory("ProjectRepository",a),a.$inject=["$http","$q","$cacheFactory"]}(),function(){function a(a,b,c){var d={},e="/api/frontendSetting";return c("settingsCache"),d.getFrontendSettings=function(){var d=b.defer(),f=c.get("settingsCache");return angular.isDefined(f.get("configuration"))?(d.resolve(f.get("configuration")),d.promise):(a.get(e,{cache:!0}).success(function(a){f.put("configuration",a.frontendSettings),d.resolve(a.frontendSettings)}).error(d.reject),d.promise)},{getSettings:function(){return d.getFrontendSettings()}}}angular.module("surfCaptain").factory("SettingsRepository",a),a.$inject=["$http","$q","$cacheFactory"]}(),function(){function a(a,b){var c,d=this;this.addFavoriteProject=function(b){var c=d.getFavoriteProjects(),e=c.length,f=0;if(e){for(f;e>f;f++)if(c[f].identifier===b.identifier)return;e>2&&(c=c.slice(1,3))}c.push(b),a.put("favoriteProjects",angular.toJson(c),{end:1/0})},this.getFavoriteProjects=function(){var b=[];return angular.isDefined(a.get("favoriteProjects"))&&null!==a.get("favoriteProjects")&&(b=angular.fromJson(a.get("favoriteProjects"))),b},(c=function(){var a=d.getFavoriteProjects(),c=a.length,e=0;for(b.getProjects(),e;c>e;e++)angular.isDefined(a[e].repositoryUrl)&&b.updateFullProjectInCache(a[e].repositoryUrl)})()}angular.module("surfCaptain").service("FavorService",a),a.$inject=["cookieStore","ProjectRepository"]}(),function(){function a(){var a=[];this.addFlashMessage=function(b,c,d,e){return a.push({title:b||"",message:c||"",severity:d,time:new Date,id:e}),a},this.getFlashMessages=function(){return a},this.flush=function(){a=[]}}angular.module("surfCaptain").service("FlashMessageService",a)}(),function(){function a(){var a=[],b=function(){a=[]},c=function(b,c){a.push([b,c])},d=function(c){var d,e,f=a.length,g=f-1;if(f)for(g;g>=0;g--)d=a[g][0],e=a[g][1],c=c.slice(0,d)+e+c.slice(d);return b(),c};this.getFirstMarker=function(a){var b;return"string"!=typeof a?null:(b=a.match(new RegExp("([{]{2,2})([A-Za-z0-9]*)([}]{2,2})")),null===b?null:b[0])},this.replaceMarkers=function(a,b){var e,f;if(angular.isUndefined(b))return a;switch(e=this.getFirstMarker(a)){case null:return a=d(a);case"{{project}}":case"{{projectName}}":case"{{projectname}}":angular.isDefined(b.name)?f=b.name:(c(a.indexOf(e),e),f="");break;case"{{suffix}}":angular.isDefined(b.suffix)?f=b.suffix:(c(a.indexOf(e),e),f="");break;default:c(a.indexOf(e),e),f=""}return a=a.replace(e,f),a=this.replaceMarkers(a,b)},this.getStringBeforeFirstMarker=function(a){var b;return"string"!=typeof a?"":(b=a.indexOf(this.getFirstMarker(a)),-1===b?a:a.substring(0,b))}}angular.module("surfCaptain").service("MarkerService",a)}(),function(){function a(a,b){var c={options:{repositoryUrl:"",deploymentPath:"",context:""},nodes:[{name:"",hostname:"",username:""}]},d=this;this.contexts=[],this.setContexts=function(){0===d.contexts.length&&a.getSettings().then(function(a){d.contexts=[],angular.isDefined(a.contexts)&&(d.contexts=a.contexts.split(","))})},this.getNewPreset=function(a){var b=angular.copy(c);return angular.isDefined(a)&&(angular.isDefined(a.defaultUser)&&(b.nodes[0].username=a.defaultUser),angular.isDefined(a.defaultDeploymentPath)&&(b.options.deploymentPath=a.defaultDeploymentPath)),b},this.getRootContext=function(a,c){this.setContexts();var d=0,e=c.length;for(d;e>d;d++)if(b.doesStringStartWithSubstring(a,c[d]))return c[d];return"unknown-context"}}angular.module("surfCaptain").service("PresetService",a),a.$inject=["SettingsRepository","ValidationService"]}(),function(){function a(){this.getDeployedTag=function(a,b){var c,d=b.length,e=0;for(e;d>e;e++)b[e].name==="server-"+a&&(c=b[e].commit);if(angular.isUndefined(c))return"No deployed tag found.";for(e=0;d>e;e++)if(b[e].commit.id===c.id&&b[e].name!=="server-"+a)return b[e].type+" "+b[e].name+" - "+c.committerName+': "'+c.message+'"';return c.id+" - "+c.committerName+': "'+c.message+'"'},this.byCommitDate=function(a,b){return a.commit.date<b.commit.date?1:-1}}angular.module("surfCaptain").service("UtilityService",a)}(),function(){function a(){this.hasLength=function(a,b,c){return a.length>=b?!0:c||!1},this.doesLastCharacterMatch=function(a,b,c){return a.charAt(a.length-1)===b?!0:c||!1},this.doesArrayContainItem=function(a,b,c){return a instanceof Array&&a.indexOf(b)>-1?!0:c||!1},this.doesStringContainSubstring=function(a,b,c){return"string"==typeof a&&-1!==a.indexOf(b)?!0:c||!1},this.doesStringStartWithSubstring=function(a,b,c){return"string"==typeof a&&0===a.indexOf(b)?!0:c||!1}}angular.module("surfCaptain").service("ValidationService",a)}();